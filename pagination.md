## Pagination방식 2가지

- offset방식 : offset(몇번째부터 가져올 것인가?)과 limit(몇개를 가져올 것인가?)예약어를 통하여 select전체 결과 중 일부만 가져오는 방법이다.
- cursor방식 : cursor는 어떠한 레코드를 가리키는 포인터이고 이 cursor가 가리키는 레코드부터 일정 개수만큼 가져오는 방식이다.

## offset pagination

```sql
SELECT *
FROM items
WHERE 조건문
ORDER BY id DESC OFFSET 페이지번호
LIMIT 페이지사이즈
```

- 단점
  - **페이지 요청 시, 데이터 변화가 있는 경우 중복 데이터 발생**
    - 예를 들어, 1페이지에서 20개의 row를 불러와서 유저에게 1페이지를 띄워주었다.
    - 고객이 1페이지의 상품을 보고 있는 사이, 상품 운영팀에서 5개의 상품을 새로 올렸다면?
      - 유저가 1페이지 상품을 다 둘러보고 2페이지를 눌렀을 때, 1페이지에서 보았던 상품 20개중 마지막 5개를 다시 2페이지에서 보게 된다.
  - **대부분이 RDBMS에서 OFFSET쿼리의 퍼포먼스 이슈**
    - 페이지가 뒤로 갈수록, 앞에서 읽었던 행을 다시 읽어야하며, 버리지만 읽어야할 행의 개수가 많아져 뒤로 갈수록 느려지게 된다.
      - 예를 들어, 극단적으로 10억번째 페이지에 있는 값을 찾고 싶다면 OFFSET에 매우 큰 숫자가 들어가게 된다.
      - 이렇게 된다면, 페이지가 뒤로 갈수록 읽었던 행을 다시 읽으며, 실제 읽어야할 ROW보다 버려야할 ROW가 훨씬 많아지게 된다.

## Cursor pagination

```sql
SELECT *
FROM items
WHERE 조건문
AND id < 마지막조회ID# 직전 조회 결과의 마지막 id ORDER BY id DESC LIMIT 페이지사이즈
```

- 조회 시작부분을 인덱스로 빠르게 찾아 매번 첫 페이지만 읽도록 하는 방식으로 offset과는 다르게 버려야할 행이 발생X
  - 즉, 매번 이전 페이지 전체를 건너뛸 수 있음을 의미한다.
  - 따라서, offset기반 페이지네이션 보다 훨씬 더 좋은 성능을 보여준다.
- UI상으로는 무한스크롤이 될 수 있다.

- 사용 시 유의사항
  - where에 사용되는 기준 key가 중복이 가능한 경우
    - 정확한 결과를 반환할 수 없다.
  - 서비스 정책상 무조건 페이징 버튼이 필요하다면 cursor를 사용하면 안된다.

- 참조블로그
  - https://jojoldu.tistory.com/528
  - https://wonyong-jang.github.io/database/2020/09/06/DB-Pagination.html